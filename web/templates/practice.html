<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>everytiān</title>
		<style>
			body {
				font-family: Arial;
			}
		</style>
	<body>

		<style>

			.word {
				font-size: 30pt;
				margin-right: 2px; 
				display: inline;
			}

			.unknown {
				border-bottom: 4px solid #e74c3c;
			}

			.explain-box {
				border-top: 2px solid #bdc3c7;
				margin-top: 5px;
				position: fixed;
		    	bottom: 0;
		    	width: 100%;

			}

			.explain-box .pronunciation {
				font-size: 15pt;
			}

			.explain-box .definition {
				font-size: 13pt;
				list-style: none;
				margin-top: 20px;
			    padding: 0;
			}

			.actions {
				margin-top: 40px;
			}

			#translation {
				display: none;
				font-size: 15pt;
				margin-top: 15pt;
				margin-bottom: 15pt;
			}

			nav ul {
				list-style-type: none;
				padding: 0px;
				margin: 0px;
			}

			nav ul li {
				margin: 5px;
				padding: 5px;
				display: inline;
			}

			.section-actions ul {
				list-style-type: none;
				padding: 0px;
				margin: 0px;
				margin-top: 10px;
			}

			.section-actions ul li {
				margin: 5px;
				padding: 5px;
				display: inline;
			}

			.hidden {
				display: none;
			}

		</style>

		<nav>
			<div id="top-level">
				<ul>
					<li>everytiān</li>
					<li><a href="{% url 'practice' %}">Practice</a></li>
					<li><a href="{% url 'favorites' %}">Favorites</a></li>
					<li><a href="{% url 'evolution' %}">Evolution</a></li>
					<li><a href="{% url 'settings' %}">Settings</a></li>
				</ul>

			</div>
		</nav>
		<form method="POST" action="{% url 'practice' %}">
			{% csrf_token %}
			<input name="resource_id" type="hidden" value="{{ resource_id }}">
			<section class="section-actions">
				<div id="resource-level">
					<ul>
						<li id="favorite">Favorite</li>
						<input name="favorite" type="checkbox" class="hidden">
						<li id="share">
							<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.everytian.com" data-text="{{ tweet }}" data-hashtags="everytian">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
						</li>
						<li id="translate">Translate</li>
					</ul>
				</div>
			</section>
			{% if audio > 0 %}
			<audio controls autoplay>
			  <source src="https://audio.tatoeba.org/sentences/cmn/{{ audio }}.mp3" type="audio/mpeg">
			Your browser does not support the audio element.
			</audio>
			{% endif %}
			<section class="text">
				{% for word in text %}
					<span class="word">{{ word }}</span>
					<input name="unknown" type="checkbox" value="{{ word }}" class="hidden">
				{% endfor %}
				<div id="translation">{{ translation }}</div>
			</section>
			<section class="explain-box">
				<div class="word"></div>
				<div class="pronunciation"></div>
				<ul class="definition"></ul>
			</section>
			<input type="submit" value="Next!">
		</form>
		<script src="../static/jquery-3.1.1.min.js"></script>
		<script src="../static/notify.min.js"></script>
		<script>
			{% autoescape off %}
			var dict = {{ word_definitions }};
			{% endautoescape %}

			favorite = false;

			function explain(word, pronunciation, definitions){
				$( ".explain-box .word" ).text(word);
				$( ".explain-box .pronunciation" ).text(pronunciation);
				def_list = $( ".explain-box .definition" ).empty();
				for(var i = 0; i < definitions.length; i++){
					def_list.append("<li>" + definitions[i] + "</li>");	
				}
			}

			var last_touched="";

			function clear_explain(){
				$( ".explain-box .word" ).empty();
				$( ".explain-box .pronunciation" ).empty();
				$( ".explain-box .definition" ).empty();
			}

			$( ".word" ).click(function(event) {
			  touched_word = $(this).text()
			  if(touched_word in dict) {
			  	if (last_touched == touched_word){
			  		if ($(this).hasClass( "unknown" )){
			  			$(this).removeClass( "unknown" );
			  			$(this).next().prop('checked', false);
			  			clear_explain();
			  		} else {
			  			word_dict = dict[touched_word];
			  			explain(touched_word, word_dict["pinyin"], word_dict["definitions"]);
			  			$(this).addClass( "unknown" );
			  			$(this).next().prop('checked', true);
			  		}
			  	} else {
			  		word_dict = dict[touched_word];
			  		explain(touched_word, word_dict["pinyin"], word_dict["definitions"]);
			  		if (!$(this).hasClass("unknown")){
			  			$(this).addClass("unknown");
			  			$(this).next().prop('checked', true);
			  		}
			  	};
			  	last_touched = touched_word;
			  }
			});

			$( "#translate" ).click(function(event) {
			  if(event.target.innerHTML == 'Translate') {
			  	$("#translation").show();
			  	event.target.innerHTML = "Hide translation";
			  } else {
			  	$("#translation").hide();
			  	event.target.innerHTML = 'Translate';
			  }
			});

			$( "#favorite" ).click(function(event) {
			  if(event.target.innerHTML == 'Favorite') {
			  	favorite = true;
			  	$(this).text("Remove favorite");
			  	$(this).next().prop('checked', true);
			  } else {
			  	favorite = false;
			  	$(this).next().prop('checked', false);
			  	$(this).text("Favorite");
			  }
			});

			{% for learned_word in learned %}
				$.notify("you learned {{ learned_word }}!", "success")
			{% endfor %}
			{% for forgotten_word in forgotten %}
				$.notify("you forgotten {{ forgotten_word }}!", "error")
			{% endfor %}
			{% for discov_known_word in discov_known %}
				$.notify("{{ discov_known_word }} added to your known dictionary", "info")
			{% endfor %}
			{% for discov_unknown_word in discov_unknown %}
				$.notify("{{ discov_unknown_word }} added to your unknown dictionary", "warn")
			{% endfor %}

		</script>

	</body>
</html>